<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highlighted Syntax</title>
    <link rel="stylesheet" href="highlight.css">
</head>

<body>
    <pre>
<span class="comment"># Copyright 2015 The TensorFlow Authors. All Rights Reserved.</span><span class="">
</span><span class="comment">#</span><span class="">
</span><span class="comment"># Licensed under the Apache License, Version 2.0 (the "License");</span><span class="">
</span><span class="comment"># you may not use this file except in compliance with the License.</span><span class="">
</span><span class="comment"># You may obtain a copy of the License at</span><span class="">
</span><span class="comment">#</span><span class="">
</span><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><span class="">
</span><span class="comment">#</span><span class="">
</span><span class="comment"># Unless required by applicable law or agreed to in writing, software</span><span class="">
</span><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span><span class="">
</span><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span class="">
</span><span class="comment"># See the License for the specific language governing permissions and</span><span class="">
</span><span class="comment"># limitations under the License.</span><span class="">
</span><span class="comment"># ==============================================================================</span><span class="">
</span><span class="string">""</span><span class="string">"Test cases for custom float Python types."</span><span class="string">""</span><span class="">
</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">collections</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">copy</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">itertools</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">math</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">sys</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">typing</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">Type</span><span class="">
</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">absl</span><span class="punctuation">.</span><span class="variable">testing</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">absltest</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">absl</span><span class="punctuation">.</span><span class="variable">testing</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">parameterized</span><span class="">
</span><span class="">
</span><span class="reserved_words">import</span><span class=""> </span><span class="variable">numpy</span><span class=""> </span><span class="reserved_words">as</span><span class=""> </span><span class="variable">np</span><span class="">
</span><span class="">
</span><span class="comment"># pylint: disable=unused-import,g-bad-import-order</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">tensorflow</span><span class="punctuation">.</span><span class="variable">python</span><span class="punctuation">.</span><span class="variable">framework</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">dtypes</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">tensorflow</span><span class="punctuation">.</span><span class="variable">python</span><span class="punctuation">.</span><span class="variable">lib</span><span class="punctuation">.</span><span class="variable">core</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">_pywrap_float8</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">tensorflow</span><span class="punctuation">.</span><span class="variable">python</span><span class="punctuation">.</span><span class="variable">lib</span><span class="punctuation">.</span><span class="variable">core</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">_pywrap_custom_casts</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">tensorflow</span><span class="punctuation">.</span><span class="variable">python</span><span class="punctuation">.</span><span class="variable">platform</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">test</span><span class="">
</span><span class="reserved_words">from</span><span class=""> </span><span class="variable">tensorflow</span><span class="punctuation">.</span><span class="variable">tsl</span><span class="punctuation">.</span><span class="variable">python</span><span class="punctuation">.</span><span class="variable">lib</span><span class="punctuation">.</span><span class="variable">core</span><span class=""> </span><span class="reserved_words">import</span><span class=""> </span><span class="variable">pywrap_bfloat16</span><span class="">
</span><span class="">
</span><span class="variable">bfloat16</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">pywrap_bfloat16</span><span class="punctuation">.</span><span class="func_name">bfloat16_type</span><span class="paren">()</span><span class="">
</span><span class="variable">float8_e4m3b11</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">pywrap_bfloat16</span><span class="punctuation">.</span><span class="func_name">float8_e4m3b11_type</span><span class="paren">()</span><span class="">
</span><span class="variable">float8_e4m3fn</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">_pywrap_float8</span><span class="punctuation">.</span><span class="func_name">TF_float8_e4m3fn_type</span><span class="paren">()</span><span class="">
</span><span class="variable">float8_e5m2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">_pywrap_float8</span><span class="punctuation">.</span><span class="func_name">TF_float8_e5m2_type</span><span class="paren">()</span><span class="">
</span><span class="variable">_pywrap_custom_casts</span><span class="punctuation">.</span><span class="func_name">TF_register_custom_casts</span><span class="paren">()</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">*</span><span class="smooth_operator">*</span><span class="variable">kwargs</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">a</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">a</span><span class="punctuation">.</span><span class="variable">dtype</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class=""> </span><span class="reserved_words">else</span><span class=""> </span><span class="variable">a</span><span class="">
</span><span class="">    </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">b</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">b</span><span class="punctuation">.</span><span class="variable">dtype</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class=""> </span><span class="reserved_words">else</span><span class=""> </span><span class="variable">b</span><span class="">
</span><span class="">    </span><span class="reserved_words">return</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_allclose</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">*</span><span class="smooth_operator">*</span><span class="variable">kwargs</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">numpy_promote_types</span><span class="paren">(</span><span class="">
</span><span class="">        </span><span class="variable">a</span><span class="punctuation">:</span><span class=""> </span><span class="variable">Type</span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">generic</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">:</span><span class=""> </span><span class="variable">Type</span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">generic</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">:</span><span class=""> </span><span class="variable">Type</span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">generic</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="variable">next_largest_fp_type</span><span class="punctuation">:</span><span class=""> </span><span class="variable">Type</span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">generic</span><span class="brackets">]</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">-</span><span class="smooth_operator">></span><span class=""> </span><span class="variable">Type</span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">generic</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class=""> </span><span class="reserved_words">and</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">return</span><span class=""> </span><span class="variable">float_type</span><span class="">
</span><span class="">    </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">next_largest_fp_type</span><span class="">
</span><span class="">    </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">next_largest_fp_type</span><span class="">
</span><span class="">    </span><span class="reserved_words">return</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">promote_types</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">isinstance</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">ndarray</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">return</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="variable">else</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">return</span><span class=""> </span><span class="func_name">type</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">x</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">test_binary_operation</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">op</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">a</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">b</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="variable">expected</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">a</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">b</span><span class="paren">))</span><span class="">
</span><span class="">    </span><span class="variable">result</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">math</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">expected</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">if</span><span class=""> </span><span class="reserved_words">not</span><span class=""> </span><span class="variable">math</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">result</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">raise</span><span class=""> </span><span class="func_name">AssertionError</span><span class="paren">(</span><span class="string">"%s expected to be nan."</span><span class=""> </span><span class="smooth_operator">%</span><span class=""> </span><span class="func_name">repr</span><span class="paren">(</span><span class="variable">result</span><span class="paren">))</span><span class="">
</span><span class="">    </span><span class="variable">else</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">expected</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="variable">result</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="string">""</span><span class="string">"Determines if the dtype has an `inf` representation."</span><span class="string">""</span><span class="">
</span><span class="">    </span><span class="variable">inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="variable">is_inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="reserved_words">False</span><span class="">
</span><span class="">    </span><span class="variable">try</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">inf</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">is_inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isinf</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="">
</span><span class="">    </span><span class="reserved_words">except</span><span class=""> </span><span class="paren">(</span><span class="variable">OverflowError</span><span class="punctuation">,</span><span class=""> </span><span class="variable">ValueError</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">pass</span><span class="">
</span><span class="">    </span><span class="reserved_words">return</span><span class=""> </span><span class="variable">is_inf</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="comment"># Configure bounds and properties for our custom types, to be used in tests</span><span class="">
</span><span class="comment"># below.</span><span class="">
</span><span class="variable">FLOAT_EPSILON</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-7"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-3"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-3"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-2"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="variable">FLOAT_MAX</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.FEp127"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.Ep4"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.Cp8"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.Cp15"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="variable">FLOAT_SMALLEST_SUBNORMAL</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-133"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-13"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-9"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-16"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="variable">FLOAT_SMALLEST_NORMAL</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-126"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-10"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-6"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="variable">float</span><span class="punctuation">.</span><span class="func_name">fromhex</span><span class="paren">(</span><span class="string">"1.0p-14"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="comment"># Values that should round trip exactly to float and back.</span><span class="">
</span><span class="comment"># pylint: disable=g-complex-comprehension</span><span class="">
</span><span class="variable">FLOAT_VALUES</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">dtype</span><span class="punctuation">:</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">        </span><span class="number">0.0</span><span class="punctuation">,</span><span class=""> </span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="number">0.5</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">0.5</span><span class="punctuation">,</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">1.0</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="number">1.0</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="smooth_operator">-</span><span class="number">1.0</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1.0</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">5</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="variable">FLOAT_MAX</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">FLOAT_MAX</span><span class="brackets">[</span><span class="variable">dtype</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-nan"</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">else</span><span class=""> </span><span class="number">0.0</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">else</span><span class=""> </span><span class="number">0.0</span><span class="">
</span><span class="">    </span><span class="brackets">]</span><span class=""> </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="punctuation">.</span><span class="func_name">keys</span><span class="paren">()</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="comment"># Values that should round trip exactly to integer and back.</span><span class="">
</span><span class="variable">INT_VALUES</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="brackets">[</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="punctuation">,</span><span class=""> </span><span class="number">34</span><span class="punctuation">,</span><span class=""> </span><span class="number">47</span><span class="punctuation">,</span><span class=""> </span><span class="number">128</span><span class="punctuation">,</span><span class=""> </span><span class="number">255</span><span class="punctuation">,</span><span class=""> </span><span class="number">256</span><span class="punctuation">,</span><span class=""> </span><span class="number">512</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="func_name">list</span><span class="paren">(</span><span class="func_name">range</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">30</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="paren">))</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="func_name">list</span><span class="paren">(</span><span class="func_name">range</span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">15</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">        </span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">5</span><span class="punctuation">,</span><span class=""> </span><span class="number">6</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">9</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="punctuation">,</span><span class=""> </span><span class="number">11</span><span class="punctuation">,</span><span class=""> </span><span class="number">12</span><span class="punctuation">,</span><span class=""> </span><span class="number">13</span><span class="punctuation">,</span><span class=""> </span><span class="number">14</span><span class="punctuation">,</span><span class=""> </span><span class="number">15</span><span class="punctuation">,</span><span class=""> </span><span class="number">16</span><span class="punctuation">,</span><span class=""> </span><span class="number">18</span><span class="punctuation">,</span><span class=""> </span><span class="number">20</span><span class="punctuation">,</span><span class=""> </span><span class="number">22</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">24</span><span class="punctuation">,</span><span class=""> </span><span class="number">26</span><span class="punctuation">,</span><span class=""> </span><span class="number">28</span><span class="punctuation">,</span><span class=""> </span><span class="number">30</span><span class="punctuation">,</span><span class=""> </span><span class="number">32</span><span class="punctuation">,</span><span class=""> </span><span class="number">36</span><span class="punctuation">,</span><span class=""> </span><span class="number">40</span><span class="punctuation">,</span><span class=""> </span><span class="number">44</span><span class="punctuation">,</span><span class=""> </span><span class="number">48</span><span class="punctuation">,</span><span class=""> </span><span class="number">52</span><span class="punctuation">,</span><span class=""> </span><span class="number">56</span><span class="punctuation">,</span><span class=""> </span><span class="number">60</span><span class="punctuation">,</span><span class=""> </span><span class="number">64</span><span class="punctuation">,</span><span class=""> </span><span class="number">72</span><span class="punctuation">,</span><span class=""> </span><span class="number">80</span><span class="punctuation">,</span><span class=""> </span><span class="number">88</span><span class="punctuation">,</span><span class=""> </span><span class="number">96</span><span class="punctuation">,</span><span class=""> </span><span class="number">104</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">112</span><span class="punctuation">,</span><span class=""> </span><span class="number">120</span><span class="punctuation">,</span><span class=""> </span><span class="number">128</span><span class="punctuation">,</span><span class=""> </span><span class="number">144</span><span class="punctuation">,</span><span class=""> </span><span class="number">160</span><span class="punctuation">,</span><span class=""> </span><span class="number">176</span><span class="punctuation">,</span><span class=""> </span><span class="number">192</span><span class="punctuation">,</span><span class=""> </span><span class="number">208</span><span class="punctuation">,</span><span class=""> </span><span class="number">224</span><span class="punctuation">,</span><span class=""> </span><span class="number">240</span><span class="punctuation">,</span><span class=""> </span><span class="number">256</span><span class="punctuation">,</span><span class=""> </span><span class="number">288</span><span class="punctuation">,</span><span class=""> </span><span class="number">320</span><span class="punctuation">,</span><span class=""> </span><span class="number">352</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">384</span><span class="punctuation">,</span><span class=""> </span><span class="number">416</span><span class="punctuation">,</span><span class=""> </span><span class="number">448</span><span class="">
</span><span class="">    </span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">        </span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">5</span><span class="punctuation">,</span><span class=""> </span><span class="number">6</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="punctuation">,</span><span class=""> </span><span class="number">12</span><span class="punctuation">,</span><span class=""> </span><span class="number">14</span><span class="punctuation">,</span><span class=""> </span><span class="number">16</span><span class="punctuation">,</span><span class=""> </span><span class="number">20</span><span class="punctuation">,</span><span class=""> </span><span class="number">24</span><span class="punctuation">,</span><span class=""> </span><span class="number">28</span><span class="punctuation">,</span><span class=""> </span><span class="number">32</span><span class="punctuation">,</span><span class=""> </span><span class="number">40</span><span class="punctuation">,</span><span class=""> </span><span class="number">48</span><span class="punctuation">,</span><span class=""> </span><span class="number">56</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">64</span><span class="punctuation">,</span><span class=""> </span><span class="number">80</span><span class="punctuation">,</span><span class=""> </span><span class="number">96</span><span class="punctuation">,</span><span class=""> </span><span class="number">112</span><span class="punctuation">,</span><span class=""> </span><span class="number">128</span><span class="punctuation">,</span><span class=""> </span><span class="number">160</span><span class="punctuation">,</span><span class=""> </span><span class="number">192</span><span class="punctuation">,</span><span class=""> </span><span class="number">224</span><span class="punctuation">,</span><span class=""> </span><span class="number">256</span><span class="punctuation">,</span><span class=""> </span><span class="number">320</span><span class="punctuation">,</span><span class=""> </span><span class="number">384</span><span class="punctuation">,</span><span class=""> </span><span class="number">448</span><span class="punctuation">,</span><span class=""> </span><span class="number">512</span><span class="punctuation">,</span><span class=""> </span><span class="number">640</span><span class="punctuation">,</span><span class=""> </span><span class="number">768</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">896</span><span class="punctuation">,</span><span class=""> </span><span class="number">1024</span><span class="punctuation">,</span><span class=""> </span><span class="number">1280</span><span class="punctuation">,</span><span class=""> </span><span class="number">1536</span><span class="punctuation">,</span><span class=""> </span><span class="number">1792</span><span class="punctuation">,</span><span class=""> </span><span class="number">2048</span><span class="punctuation">,</span><span class=""> </span><span class="number">2560</span><span class="punctuation">,</span><span class=""> </span><span class="number">3072</span><span class="punctuation">,</span><span class=""> </span><span class="number">3584</span><span class="punctuation">,</span><span class=""> </span><span class="number">4096</span><span class="punctuation">,</span><span class=""> </span><span class="number">5120</span><span class="punctuation">,</span><span class=""> </span><span class="number">6144</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">7168</span><span class="punctuation">,</span><span class=""> </span><span class="number">8192</span><span class="punctuation">,</span><span class=""> </span><span class="number">10240</span><span class="punctuation">,</span><span class=""> </span><span class="number">12288</span><span class="punctuation">,</span><span class=""> </span><span class="number">14336</span><span class="punctuation">,</span><span class=""> </span><span class="number">16384</span><span class="punctuation">,</span><span class=""> </span><span class="number">20480</span><span class="punctuation">,</span><span class=""> </span><span class="number">24576</span><span class="punctuation">,</span><span class=""> </span><span class="number">28672</span><span class="punctuation">,</span><span class=""> </span><span class="number">32768</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="number">40960</span><span class="punctuation">,</span><span class=""> </span><span class="number">49152</span><span class="punctuation">,</span><span class=""> </span><span class="number">57344</span><span class="">
</span><span class="">    </span><span class="brackets">]</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="variable">BITS_TYPE</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="variable">bfloat16</span><span class="punctuation">:</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint16</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3b11</span><span class="punctuation">:</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e4m3fn</span><span class="punctuation">:</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">float8_e5m2</span><span class="punctuation">:</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="">
</span><span class="keys">}</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="comment"># pylint: disable=g-complex-comprehension</span><span class="">
</span><span class="">@</span><span class="variable">parameterized</span><span class="punctuation">.</span><span class="func_name">named_parameters</span><span class="paren">((</span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="string">"testcase_name"</span><span class="punctuation">:</span><span class=""> </span><span class="string">"_"</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">dtype</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="string">"float_type"</span><span class="punctuation">:</span><span class=""> </span><span class="variable">dtype</span><span class="">
</span><span class="keys">}</span><span class=""> </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">bfloat16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3b11</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3fn</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e5m2</span><span class="brackets">]</span><span class="paren">))</span><span class="">
</span><span class="reserved_words">class</span><span class=""> </span><span class="func_name">CustomFloatTest</span><span class="paren">(</span><span class="variable">parameterized</span><span class="punctuation">.</span><span class="variable">TestCase</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="string">""</span><span class="string">"Tests the non-numpy Python methods of the custom float type."</span><span class="string">""</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testRoundTripToFloat</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">v</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testRoundTripNumpyTypes</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">f</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">f</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">f</span><span class="paren">))))</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">f</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">f</span><span class="paren">))))</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">f</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">f</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="paren">))))</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testRoundTripToInt</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">INT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">int</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)))</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="variable">v</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">int</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="variable">v</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testRoundTripToNumpy</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="">
</span><span class="">        </span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">dtype</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                        </span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">v</span><span class="paren">))))</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                        </span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">v</span><span class="paren">))))</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                        </span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">dtype</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">v</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="paren">))))</span><span class="">
</span><span class="">                </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="smooth_operator">!=</span><span class=""> </span><span class="variable">float_type</span><span class="punctuation">:</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                        </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                        </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">                                            </span><span class="variable">dtype</span><span class="paren">))</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testBetweenCustomTypes</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">bfloat16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3b11</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3fn</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e5m2</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">z</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">z</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testStr</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">value</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="string">"%.6g"</span><span class=""> </span><span class="smooth_operator">%</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">value</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                             </span><span class="func_name">str</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">value</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testFromStr</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">1.2</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="string">"1.2"</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="string">"-nan"</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">))</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testRepr</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">value</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="string">"%.6g"</span><span class=""> </span><span class="smooth_operator">%</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">value</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                             </span><span class="func_name">repr</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">value</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testItem</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertIsInstance</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">0</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">item</span><span class="paren">()</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testHashZero</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Tests that negative zero and zero hash to the same value."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="func_name">hash</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">0.0</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">0.0</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testHashNumbers</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">value</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">extract</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isfinite</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">value</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="func_name">hash</span><span class="paren">(</span><span class="variable">value</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">value</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">str</span><span class="paren">(</span><span class="variable">value</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testHashNan</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">name</span><span class="punctuation">,</span><span class=""> </span><span class="variable">nan</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="paren">(</span><span class="string">"PositiveNan"</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)))</span><span class="punctuation">,</span><span class="">
</span><span class="">                          </span><span class="paren">(</span><span class="string">"NegativeNan"</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-nan"</span><span class="paren">)))</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">name</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">nan_hash</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="variable">nan</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">nan_object_hash</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">object</span><span class="punctuation">.</span><span class="func_name">__hash__</span><span class="paren">(</span><span class="variable">nan</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="comment"># The hash of a NaN is either 0 or a hash of the object pointer.</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertIn</span><span class="paren">(</span><span class="variable">nan_hash</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="variable">sys</span><span class="punctuation">.</span><span class="variable">hash_info</span><span class="punctuation">.</span><span class="variable">nan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">nan_object_hash</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                              </span><span class="func_name">str</span><span class="paren">(</span><span class="variable">nan</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testHashInf</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">sys</span><span class="punctuation">.</span><span class="variable">hash_info</span><span class="punctuation">.</span><span class="variable">inf</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)))</span><span class="punctuation">,</span><span class=""> </span><span class="string">"inf"</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="variable">sys</span><span class="punctuation">.</span><span class="variable">hash_info</span><span class="punctuation">.</span><span class="variable">inf</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)))</span><span class="punctuation">,</span><span class="">
</span><span class="">                             </span><span class="string">"-inf"</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="comment"># Tests for Python operations</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testNegate</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="func_name">float</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">))))</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testAdd</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3.5</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="func_name">test_binary_operation</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">op</span><span class="smooth_operator">=</span><span class="reserved_words">lambda</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">:</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testAddScalarTypePromotion</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Tests type promotion against Numpy scalar values."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">types</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="brackets">]</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">lhs_type</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">types</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">rhs_type</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">types</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">expected_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">numpy_promote_types</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="variable">lhs_type</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">rhs_type</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">next_largest_fp_type</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">actual_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">type</span><span class="paren">(</span><span class="func_name">lhs_type</span><span class="paren">(</span><span class="number">3.5</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="func_name">rhs_type</span><span class="paren">(</span><span class="number">2.25</span><span class="paren">))</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">expected_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">actual_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testAddArrayTypePromotion</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class="">
</span><span class="">                         </span><span class="func_name">type</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">3.5</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="number">2.25</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class="">
</span><span class="">                         </span><span class="func_name">type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">2.25</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testSub</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3.5</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="func_name">test_binary_operation</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">op</span><span class="smooth_operator">=</span><span class="reserved_words">lambda</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">:</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testMul</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="func_name">test_binary_operation</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">op</span><span class="smooth_operator">=</span><span class="reserved_words">lambda</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">:</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">*</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testDiv</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">1</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3.5</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2.25</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                     </span><span class="paren">(</span><span class="number">3.5</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="func_name">test_binary_operation</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">op</span><span class="smooth_operator">=</span><span class="reserved_words">lambda</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class="punctuation">:</span><span class=""> </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">/</span><span class=""> </span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testLess</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testLessEqual</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator"><</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator"><</span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testGreater</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator">></span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">></span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testGreaterEqual</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator">></span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">></span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testEqual</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testNotEqual</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">v</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">w</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">v</span><span class=""> </span><span class="smooth_operator">!=</span><span class=""> </span><span class="variable">w</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">v</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">!=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">w</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testNan</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">a</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="variable">a</span><span class="brackets">]</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="variable">a</span><span class="brackets">]</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="brackets">[</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">1.34375</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">             </span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">1.4375</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">             </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="brackets">[</span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">1.3359375</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">             </span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">1.4375</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">             </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="brackets">]</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">a</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">b</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">0.1</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">atol</span><span class="smooth_operator">=</span><span class="number">0.1</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">equal_nan</span><span class="smooth_operator">=</span><span class="variable">True</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">err_msg</span><span class="smooth_operator">=</span><span class="string">""</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">verbose</span><span class="smooth_operator">=</span><span class="variable">True</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testSort</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="comment"># Note: np.sort doesn't work properly with NaNs since they always compare</span><span class="">
</span><span class="">        </span><span class="comment"># False.</span><span class="">
</span><span class="">        </span><span class="variable">values_to_sort</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="brackets">[</span><span class="variable">x</span><span class=""> </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">x</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class=""> </span><span class="reserved_words">if</span><span class=""> </span><span class="reserved_words">not</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="brackets">]</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">sorted_f32</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">sort</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">sorted_float_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">sort</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="paren">))</span><span class="">  </span><span class="comment"># pylint: disable=too-many-function-args</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">sorted_f32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">sorted_float_type</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgmax</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">values_to_sort</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="variable">argmax_f32</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">argmax_float_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="paren">))</span><span class="">  </span><span class="comment"># pylint: disable=too-many-function-args</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">argmax_f32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">argmax_float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgmaxOnNan</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Ensures we return the right thing for multiple NaNs."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">one_with_nans</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="brackets">[</span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">one_with_nans</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">one_with_nans</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgmaxOnNegativeInfinity</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Ensures we return the right thing for negative infinities."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"-inf"</span><span class="paren">)</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">inf</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmax</span><span class="paren">(</span><span class="variable">inf</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgmin</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">values_to_sort</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)))</span><span class="">
</span><span class="">        </span><span class="variable">argmin_f32</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">argmin_float_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">values_to_sort</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="paren">))</span><span class="">  </span><span class="comment"># pylint: disable=too-many-function-args</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">argmin_f32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">argmin_float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgminOnNan</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Ensures we return the right thing for multiple NaNs."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">one_with_nans</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="brackets">[</span><span class="number">1.0</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">)</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">one_with_nans</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">one_with_nans</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArgminOnPositiveInfinity</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="string">""</span><span class="string">"Ensures we return the right thing for positive infinities."</span><span class="string">""</span><span class="">
</span><span class="">        </span><span class="variable">inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">)</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">inf</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">argmin</span><span class="paren">(</span><span class="variable">inf</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testDtypeFromString</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">assert</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="variable">BinaryOp</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">collections</span><span class="punctuation">.</span><span class="func_name">namedtuple</span><span class="paren">(</span><span class="string">"BinaryOp"</span><span class="punctuation">,</span><span class=""> </span><span class="brackets">[</span><span class="string">"op"</span><span class="brackets">]</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="variable">UNARY_UFUNCS</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">negative</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">positive</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">absolute</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">fabs</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">rint</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">sign</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">conjugate</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">exp</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">exp2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">expm1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">log</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">log10</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">log1p</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">log2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">sqrt</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">square</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">cbrt</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">reciprocal</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">sin</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">cos</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">tan</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arcsin</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arccos</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arctan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">sinh</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">cosh</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">tanh</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arcsinh</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arccosh</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arctanh</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">deg2rad</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">rad2deg</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">floor</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">ceil</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">trunc</span><span class="">
</span><span class="brackets">]</span><span class="">
</span><span class="">
</span><span class="variable">BINARY_UFUNCS</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">add</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">subtract</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">multiply</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">divide</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logaddexp</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logaddexp2</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">floor_divide</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">power</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">remainder</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">fmod</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">heaviside</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">arctan2</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">hypot</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">maximum</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">minimum</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">fmax</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">fmin</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">copysign</span><span class="">
</span><span class="brackets">]</span><span class="">
</span><span class="">
</span><span class="variable">BINARY_PREDICATE_UFUNCS</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">equal</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">not_equal</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">less</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">greater</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">less_equal</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">greater_equal</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logical_and</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logical_or</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logical_xor</span><span class="">
</span><span class="brackets">]</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="comment"># pylint: disable=g-complex-comprehension</span><span class="">
</span><span class="">@</span><span class="variable">parameterized</span><span class="punctuation">.</span><span class="func_name">named_parameters</span><span class="paren">((</span><span class="keys">{</span><span class="">
</span><span class="">    </span><span class="string">"testcase_name"</span><span class="punctuation">:</span><span class=""> </span><span class="string">"_"</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="variable">dtype</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="punctuation">,</span><span class="">
</span><span class="">    </span><span class="string">"float_type"</span><span class="punctuation">:</span><span class=""> </span><span class="variable">dtype</span><span class="">
</span><span class="keys">}</span><span class=""> </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">bfloat16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3b11</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e4m3fn</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float8_e5m2</span><span class="brackets">]</span><span class="paren">))</span><span class="">
</span><span class="reserved_words">class</span><span class=""> </span><span class="func_name">CustomFloatNumPyTest</span><span class="paren">(</span><span class="variable">parameterized</span><span class="punctuation">.</span><span class="variable">TestCase</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="string">""</span><span class="string">"Tests NumPy integration of the custom float types."</span><span class="string">""</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testDtype</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testDeepCopyDoesNotAlterHash</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="comment"># For context, see https://github.com/google/jax/issues/4651. If the hash</span><span class="">
</span><span class="">        </span><span class="comment"># value of the type descriptor is not initialized correctly, a deep copy</span><span class="">
</span><span class="">        </span><span class="comment"># can change the type hash.</span><span class="">
</span><span class="">        </span><span class="variable">dtype</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">dtype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">h</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">_</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">copy</span><span class="punctuation">.</span><span class="func_name">deepcopy</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">h</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">hash</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArray</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[[</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3</span><span class="brackets">]]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="string">"[[1 2 3]]"</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">str</span><span class="paren">(</span><span class="variable">x</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">x</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">((</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">all</span><span class="paren">())</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testComparisons</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">30</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">30</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">17</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">0</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">by</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">!=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator">!=</span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">></span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator">></span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator"><</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator"><</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">></span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">,</span><span class=""> </span><span class="variable">bx</span><span class=""> </span><span class="smooth_operator">></span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">by</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testEqual2</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">a</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">31</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">b</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">15</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertFalse</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">.</span><span class="func_name">__eq__</span><span class="paren">(</span><span class="variable">b</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testCanCast</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">allowed_casts</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">bool_</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex64</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex128</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">clongdouble</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">        </span><span class="brackets">]</span><span class="">
</span><span class="">        </span><span class="variable">all_dtypes</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int16</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex128</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">clongdouble</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">intc</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int_</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longlong</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uintc</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">ulonglong</span><span class="">
</span><span class="">        </span><span class="brackets">]</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">d</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">all_dtypes</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">d</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">((</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">d</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">allowed_casts</span><span class="punctuation">,</span><span class="">
</span><span class="">                                 </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">can_cast</span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">d</span><span class="paren">))</span><span class="">
</span><span class="">                </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">((</span><span class="variable">d</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">allowed_casts</span><span class="punctuation">,</span><span class="">
</span><span class="">                                 </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">can_cast</span><span class="paren">(</span><span class="variable">d</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testCasts</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longdouble</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int16</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex128</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">clongdouble</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint8</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint16</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint32</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uint64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">intc</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int_</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">longlong</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">uintc</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">ulonglong</span><span class="">
</span><span class="">        </span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[[</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">,</span><span class=""> </span><span class="number">3</span><span class="brackets">]]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">z</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">all</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y</span><span class="paren">))</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">all</span><span class="paren">(</span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">z</span><span class="paren">))</span><span class="">
</span><span class="">            </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">dtype</span><span class="punctuation">,</span><span class=""> </span><span class="variable">z</span><span class="punctuation">.</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testConformNumpyComplex</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">dtype</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex64</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">complex128</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">clongdouble</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="brackets">[</span><span class="number">1.5</span><span class="punctuation">,</span><span class=""> </span><span class="number">2.5</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="number">2</span><span class="punctuation">.</span><span class="variable">j</span><span class="punctuation">,</span><span class=""> </span><span class="number">3.5</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">y_np</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">y_tf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">y_np</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y_tf</span><span class="punctuation">,</span><span class=""> </span><span class="variable">atol</span><span class="smooth_operator">=</span><span class="number">2e-2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="variable">z_np</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y_np</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="variable">z_tf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">y_tf</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">            </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">z_np</span><span class="punctuation">,</span><span class=""> </span><span class="variable">z_tf</span><span class="punctuation">,</span><span class=""> </span><span class="variable">atol</span><span class="smooth_operator">=</span><span class="number">2e-2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testArange</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="number">100</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="number">100</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">8</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">0</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">0.25</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">0</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">2</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="number">0.25</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">16</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="number">16</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">arange</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">16</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="number">16</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testUnaryUfunc</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">op</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">UNARY_UFUNCS</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">op</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="func_name">truncate</span><span class="paren">(</span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-4</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testBinaryUfunc</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">op</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">BINARY_UFUNCS</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">op</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="func_name">truncate</span><span class="paren">(</span><span class="">
</span><span class="">                        </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                        </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-4</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testBinaryPredicateUfunc</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">op</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">BINARY_PREDICATE_UFUNCS</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">op</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testPredicateUfunc</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">op</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="brackets">[</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">isfinite</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">isinf</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">isnan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">signbit</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">logical_not</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">op</span><span class="punctuation">.</span><span class="variable">__name__</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">shape</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="punctuation">,</span><span class=""> </span><span class="number">10</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">posinf_flips</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">rand</span><span class="paren">(</span><span class="smooth_operator">*</span><span class="variable">shape</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="number">0.1</span><span class="">
</span><span class="">                </span><span class="variable">neginf_flips</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">rand</span><span class="paren">(</span><span class="smooth_operator">*</span><span class="variable">shape</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="number">0.1</span><span class="">
</span><span class="">                </span><span class="variable">nan_flips</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">rand</span><span class="paren">(</span><span class="smooth_operator">*</span><span class="variable">shape</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator"><</span><span class=""> </span><span class="number">0.1</span><span class="">
</span><span class="">                </span><span class="variable">vals</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="smooth_operator">*</span><span class="variable">shape</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">vals</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">where</span><span class="paren">(</span><span class="variable">posinf_flips</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">inf</span><span class="punctuation">,</span><span class=""> </span><span class="variable">vals</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">vals</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">where</span><span class="paren">(</span><span class="variable">neginf_flips</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">inf</span><span class="punctuation">,</span><span class=""> </span><span class="variable">vals</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">vals</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">where</span><span class="paren">(</span><span class="variable">nan_flips</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">nan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">vals</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">vals</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">vals</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="func_name">op</span><span class="paren">(</span><span class="variable">vals</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">op</span><span class="paren">(</span><span class="variable">vals</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testDivmod</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">4</span><span class="punctuation">,</span><span class=""> </span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">o1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">o2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">divmod</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">e1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">e2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">divmod</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">o1</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">e1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">o2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">e2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testModf</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">o1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">o2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">modf</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">e1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">e2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">modf</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">o1</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">e1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">o2</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">e2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testLdexp</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">y</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randint</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">50</span><span class="punctuation">,</span><span class=""> </span><span class="number">50</span><span class="punctuation">,</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">))</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">int32</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertEqual</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">ldexp</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="punctuation">.</span><span class="variable">dtype</span><span class="punctuation">,</span><span class=""> </span><span class="variable">x</span><span class="punctuation">.</span><span class="variable">dtype</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">ldexp</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="func_name">truncate</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">ldexp</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">y</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">atol</span><span class="smooth_operator">=</span><span class="number">1e-6</span><span class="punctuation">,</span><span class="">
</span><span class="">            </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testFrexp</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">rng</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">random</span><span class="punctuation">.</span><span class="func_name">RandomState</span><span class="paren">(</span><span class="variable">seed</span><span class="smooth_operator">=</span><span class="number">42</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">x</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">rng</span><span class="punctuation">.</span><span class="func_name">randn</span><span class="paren">(</span><span class="number">3</span><span class="punctuation">,</span><span class=""> </span><span class="number">7</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">mant1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">exp1</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">frexp</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">mant2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">exp2</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">frexp</span><span class="paren">(</span><span class="variable">x</span><span class="punctuation">.</span><span class="func_name">astype</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">exp1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">exp2</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="func_name">numpy_assert_allclose</span><span class="paren">(</span><span class="variable">mant1</span><span class="punctuation">,</span><span class=""> </span><span class="variable">mant2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">rtol</span><span class="smooth_operator">=</span><span class="number">1e-2</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testCopySign</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">bits</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="func_name">list</span><span class="paren">(</span><span class="func_name">range</span><span class="paren">(</span><span class="number">1</span><span class="punctuation">,</span><span class=""> </span><span class="number">128</span><span class="paren">))</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">bits</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">bits_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">BITS_TYPE</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="">
</span><span class="">                </span><span class="variable">val</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">bits_type</span><span class="paren">(</span><span class="variable">bits</span><span class="paren">)</span><span class="punctuation">.</span><span class="func_name">view</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">val_with_sign</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">copysign</span><span class="paren">(</span><span class="variable">val</span><span class="punctuation">,</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="number">1</span><span class="paren">))</span><span class="">
</span><span class="">                </span><span class="variable">val_with_sign_bits</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">val_with_sign</span><span class="punctuation">.</span><span class="func_name">view</span><span class="paren">(</span><span class="variable">bits_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">num_bits</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">iinfo</span><span class="paren">(</span><span class="variable">bits_type</span><span class="paren">)</span><span class="punctuation">.</span><span class="variable">bits</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">bits</span><span class=""> </span><span class="smooth_operator">|</span><span class=""> </span><span class="paren">(</span><span class="number">1</span><span class=""> </span><span class="smooth_operator"><</span><span class="smooth_operator"><</span><span class=""> </span><span class="paren">(</span><span class="variable">num_bits</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="number">1</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                                        </span><span class="variable">val_with_sign_bits</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testNextAfter</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="variable">one</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="number">1</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">two</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="number">2</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">zero</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="number">0</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">nan</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">nan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="variable">two</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="variable">zero</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class=""> </span><span class="smooth_operator">/</span><span class=""> </span><span class="number">2</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">nan</span><span class="punctuation">,</span><span class=""> </span><span class="variable">one</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">True</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="variable">nan</span><span class="paren">))</span><span class="punctuation">,</span><span class=""> </span><span class="variable">True</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">one</span><span class="punctuation">,</span><span class=""> </span><span class="variable">one</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">one</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">smallest_denormal</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">FLOAT_SMALLEST_SUBNORMAL</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">zero</span><span class="punctuation">,</span><span class=""> </span><span class="variable">one</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">smallest_denormal</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">zero</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">one</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">smallest_denormal</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">b</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">itertools</span><span class="punctuation">.</span><span class="func_name">permutations</span><span class="paren">(</span><span class="brackets">[</span><span class="number">0</span><span class="punctuation">.</span><span class="punctuation">,</span><span class=""> </span><span class="variable">nan</span><span class="brackets">]</span><span class="punctuation">,</span><span class=""> </span><span class="number">2</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">float32</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">a</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">array</span><span class="paren">(</span><span class="variable">b</span><span class="punctuation">,</span><span class=""> </span><span class="variable">dtype</span><span class="smooth_operator">=</span><span class="variable">float_type</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="reserved_words">def</span><span class=""> </span><span class="func_name">testSpacing</span><span class="paren">(</span><span class="variable">self</span><span class="punctuation">,</span><span class=""> </span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">        </span><span class="comment"># Sweep a variety of binades to see that spacing gives the proper ULP.</span><span class="">
</span><span class="">        </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">name</span><span class="smooth_operator">=</span><span class="string">"Subnormals"</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">i</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="func_name">range</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">int</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">log2</span><span class="paren">(</span><span class="variable">FLOAT_SMALLEST_SUBNORMAL</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="func_name">int</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">log2</span><span class="paren">(</span><span class="variable">FLOAT_SMALLEST_NORMAL</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)))</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">power_of_two</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">2.0</span><span class="smooth_operator">*</span><span class="smooth_operator">*</span><span class="variable">i</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">distance</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">FLOAT_SMALLEST_SUBNORMAL</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="variable">power_of_two</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">distance</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="variable">power_of_two</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">distance</span><span class="paren">)</span><span class="">
</span><span class="">        </span><span class="comment"># Normals have a distance which depends on their binade.</span><span class="">
</span><span class="">        </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">name</span><span class="smooth_operator">=</span><span class="string">"Normals"</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">i</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="func_name">range</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="func_name">int</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">log2</span><span class="paren">(</span><span class="variable">FLOAT_SMALLEST_NORMAL</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">))</span><span class="punctuation">,</span><span class="">
</span><span class="">                    </span><span class="func_name">int</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">log2</span><span class="paren">(</span><span class="variable">FLOAT_MAX</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="paren">)))</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">power_of_two</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="number">2.0</span><span class="smooth_operator">*</span><span class="smooth_operator">*</span><span class="variable">i</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">distance</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">FLOAT_EPSILON</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class=""> </span><span class="smooth_operator">*</span><span class=""> </span><span class="variable">power_of_two</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="variable">power_of_two</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">distance</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="smooth_operator">-</span><span class="variable">power_of_two</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="smooth_operator">-</span><span class="variable">distance</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="comment"># Check that spacing agrees with arithmetic involving nextafter.</span><span class="">
</span><span class="">        </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">name</span><span class="smooth_operator">=</span><span class="string">"NextAfter"</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="reserved_words">for</span><span class=""> </span><span class="variable">x</span><span class=""> </span><span class="reserved_words">in</span><span class=""> </span><span class="variable">FLOAT_VALUES</span><span class="brackets">[</span><span class="variable">float_type</span><span class="brackets">]</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">x_float_type</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">spacing</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="variable">x_float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">toward</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">copysign</span><span class="paren">(</span><span class="func_name">float_type</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="number">2.0</span><span class=""> </span><span class="smooth_operator">*</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">abs</span><span class="paren">(</span><span class="variable">x</span><span class="paren">)</span><span class=""> </span><span class="smooth_operator">+</span><span class=""> </span><span class="number">1</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">x_float_type</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="variable">nextup</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">nextafter</span><span class="paren">(</span><span class="variable">x_float_type</span><span class="punctuation">,</span><span class=""> </span><span class="variable">toward</span><span class="paren">)</span><span class="">
</span><span class="">                </span><span class="reserved_words">if</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">spacing</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                    </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">assertTrue</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">isnan</span><span class="paren">(</span><span class="variable">nextup</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">x_float_type</span><span class="paren">))</span><span class="">
</span><span class="">                </span><span class="variable">else</span><span class="punctuation">:</span><span class="">
</span><span class="">                    </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">spacing</span><span class="punctuation">,</span><span class=""> </span><span class="variable">nextup</span><span class=""> </span><span class="smooth_operator">-</span><span class=""> </span><span class="variable">x_float_type</span><span class="paren">)</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="comment"># Check that spacing for special values gives the correct answer.</span><span class="">
</span><span class="">        </span><span class="reserved_words">with</span><span class=""> </span><span class="variable">self</span><span class="punctuation">.</span><span class="func_name">subTest</span><span class="paren">(</span><span class="variable">name</span><span class="smooth_operator">=</span><span class="string">"NonFinite"</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">            </span><span class="variable">nan</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"nan"</span><span class="paren">))</span><span class="">
</span><span class="">            </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="">
</span><span class="">                </span><span class="variable">nan</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">nan</span><span class="paren">)))</span><span class="">
</span><span class="">            </span><span class="reserved_words">if</span><span class=""> </span><span class="func_name">dtype_has_inf</span><span class="paren">(</span><span class="variable">float_type</span><span class="paren">)</span><span class="punctuation">:</span><span class="">
</span><span class="">                </span><span class="variable">inf</span><span class=""> </span><span class="smooth_operator">=</span><span class=""> </span><span class="func_name">float_type</span><span class="paren">(</span><span class="func_name">float</span><span class="paren">(</span><span class="string">"inf"</span><span class="paren">))</span><span class="">
</span><span class="">                </span><span class="variable">np</span><span class="punctuation">.</span><span class="variable">testing</span><span class="punctuation">.</span><span class="func_name">assert_equal</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="">
</span><span class="">                    </span><span class="variable">inf</span><span class="paren">)</span><span class="punctuation">,</span><span class=""> </span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">spacing</span><span class="paren">(</span><span class="variable">np</span><span class="punctuation">.</span><span class="func_name">float32</span><span class="paren">(</span><span class="variable">inf</span><span class="paren">)))</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="reserved_words">if</span><span class=""> </span><span class="variable">__name__</span><span class=""> </span><span class="smooth_operator">=</span><span class="smooth_operator">=</span><span class=""> </span><span class="string">"__main__"</span><span class="punctuation">:</span><span class="">
</span><span class="">    </span><span class="variable">absltest</span><span class="punctuation">.</span><span class="func_name">main</span><span class="paren">()</span><span class="">
</span>    </pre>
</body>

</html>